(()=>{var i={},f=o=>{let e=o.split(" "),r=e,n=[],s=[],t={};for(let m=0;m<e.length;m++){let c=e[m];if(/@group|[+|-|=|:].*/.test(c)){n.push(c);let a=/([+|-|=|:])$/.test(c);(c.length===1||a)&&(n.push(e[m+1]),e=e.filter(g=>g!==e[m+1])),r=r.filter(g=>g!==c)}else s.push(c)}return t.groupData=n.join(""),t.finalContent=s.join(" "),t},p=(o,e,r)=>{if(groupName=/^(.*?)$/.exec(o.groupData.substring(r.index+1)),groupName)try{groupName=/^(.*?)[:|<br>]/.exec(o.groupData.substring(r.index+1)).pop()}catch{groupName=/^(.*?)$/.exec(o.groupData.substring(r.index+1)).pop()}if(memberName=/:(.*?)$/.exec(o.groupData.substring(r.index+1)),memberName&&(memberName=/:(.*?)$/.exec(o.groupData.substring(r.index+1)).pop()),/@group|[+]|-|=|:.*/.test(groupName+memberName)||!groupName||!groupName.length||groupName.trim()==="<br>")try{throw new Error("Invalid Group Command "+content)}catch(n){return console.error(n),e.status=-1,e.errorMessage=n.message,e}return e.groupName=groupName,e.memberName=memberName,e.groupMessage=o.finalContent,e.status=0,e.errorMessage=null,e.groupOwner=document.querySelector(".handle").innerHTML,e.ownerId=doDexMess.socket.url.split("id=")[1],e},b=(o,e)=>{let r;if(o.groupData&&o.groupData.startsWith("@group")){let n=["-","[+]","="],s,t,m;i={};for(let c=0;c<3;c++){let l=new RegExp(n[c]).exec(o.groupData);if(l)s=l[0];else continue;switch(s){case"+":r="/addGroup",i=p(o,i,l),i.method="PUT",i.uri=r;break;case"-":r="/removeGroup",i=p(o,i,l),i.method="DELETE",i.uri=r;break;case"=":i=p(o,i,l),i.method="POST",i.uri="/getGroup/"+i.groupName;break;default:console.log("Error Command/groupName******:",s,t);break}}if(!s&&!t)try{throw new Error("Invalid Group Command "+e)}catch(c){return console.error(c),i.status=-1,i.errorMessage=c.message,i}return i}};var h=!1,N=()=>{let o;try{o=document.querySelectorAll(".dial");for(let e of o)window.observer||e.addEventListener("dblclick",T)}catch(e){console.error("Error: "+e.message)}},d=async()=>{let o=document.querySelector("#dodexComm").querySelector(".user-msg"),e=document.querySelector("#dodexComm").querySelector("select");var r=o.innerHTML.replace(/&nbsp;/g,"").trim();let n=r.toLowerCase().includes("@group");if(!(r.length<2||r==="<br>"))if(r.length>1&&!n){let s=w(r);window.doDexMess.socket.send(s),o.innerHTML=""}else{let s=f(r),t=b(s,r);if(!t){chatbox.innerHTML+="Invalid input: "+r+"<br>",o.innerHTML="";return}if(t.status===-1){chatbox.innerHTML+=t.errorMessage+"<br>",o.innerHTML="";return}let m=w(t.groupMessage);t.groupMessage=m;let c="Deleting 'group/members(s)'. Are you sure?";if(t.method==="DELETE"&&(t.groupMessage.length===0||t.groupMessage===";users!![]")&&confirm(c)===!1)return;h&&console.log("Post Message:",M+"//"+y+t.uri,t);let l=await L(M+"//"+y+t.uri,t,t.method);o.innerHTML="";let u=await l.json();if(chatbox.innerHTML+=typeof u=="number"?"Failed with "+u:`${l.statusText.toLowerCase()}<br>`,chatbox.innerHTML+=u.errorMessage!==null?u.errorMessage+"<br>":"",h&&console.log("Return data",u),t.groupMessage!==""&&u.status===0&&t.groupMessage.trim().indexOf(";users!!")>5&&(o.innerHTML=t.groupMessage,d()),typeof u.members<"u"){for(let a=e.length-1;a>-1;a--)e.removeChild(e[a]);for(let a=0;a<u.members.length;a++){let g=document.createElement("OPTION");g.text=u.members[a].name,g.value=u.members[a].name,e.add(g)}}}},w=o=>{if(o.indexOf(";users!!")===-1){let e=document.querySelector("#dodexComm"),r=e.querySelector("select");if(e&&r){let n=v(r);e.querySelector('a[name="private"]').innerHTML==="Broadcast"&&(o+=";users!!"+JSON.stringify(n))}}return o},v=o=>{let e=[],r;var n=o.options.length;for(let s=0;s<n;s++)r=o.options[s],r.selected&&e.push(r.value);return e},T=()=>{let o=document.querySelector("#usermsg");if(!o||window.observer)return;let e={childList:!0,subtree:!0,attributes:!1},r=(n,s)=>{for(let t of n)if(t&&t.target&&t.target.id==="usermsg"){document.querySelector(".input-send").onclick=d,window.doDexMess.socket.onopen=()=>{document.querySelector(".input-send").onclick=d};return}};window.observer||(window.observer=new MutationObserver(r),window.observer.observe(o,e))},L=async(o="",e={},r="GET")=>await fetch(o,{method:r,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:r==="GET"?null:JSON.stringify(e)}).catch(s=>{console.error(s.message)}),M=window.location.protocol,x=window.location.port=="8890"?"8880":window.location.port=="8888"?"8087":window.location.port.toString(),y=window.location.hostname+(x.length>0?":"+x:"");window.groupListener=N;})();
